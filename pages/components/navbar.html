<!-- Shared Bootstrap Navbar for K-Pop Album Tracker -->
<nav class="navbar navbar-expand-lg navbar-custom fixed-top">
  <div class="container-fluid">
    <a
      class="navbar-brand d-flex align-items-center gap-2"
      href="/index.html"
      style="margin-bottom: 0"
    >
      <img
        src="https://cdn-icons-png.flaticon.com/512/727/727245.png"
        alt="Logo"
        style="width: 32px; height: 32px"
      />
      K-Pop Tracker
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-3 gap-2 flex-grow-1 align-items-center">
        <li class="nav-item">
          <a
            class="nav-link"
            href="../albumCollection.html"
            data-page="albumCollection.html"
            >Album Collection</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="../groupManagement.html"
            data-page="groupManagement.html"
            >Group & Member Management</a
          >
        </li>
      </ul>
      <div class="d-flex align-items-center">
  <button id="loginBtn" class="btn btn-outline-info btn-sm me-2 d-none">
          Login
        </button>
        <a
          id="profileNavLink"
          class="btn btn-info ms-2 fw-bold navbar-profile-btn"
          href="/pages/profile.html"
          >My Profile</a
        >
        <button id="logoutBtn" class="btn btn-outline-secondary btn-sm ms-2">
          Logout
        </button>
        <span id="userEmail" class="text-light small ms-2"
          >mittchelk@gmail.com</span
        >
      </div>
    </div>
  </div>
</nav>
<script type="module">
  // Highlight active nav link based on current page
  const navLinks = document.querySelectorAll(".nav-link[data-page]");
  navLinks.forEach((link) => {
    if (window.location.pathname.endsWith(link.getAttribute("data-page"))) {
      link.classList.add("active");
      link.setAttribute("aria-current", "page");
    } else {
      link.classList.remove("active");
      link.removeAttribute("aria-current");
    }
  });

  // Collapse navbar if width > 990px, only after Bootstrap is loaded
  function collapseNavbarOnDesktop() {
    const navbarCollapse = document.getElementById("navbarNav");
    const toggler = document.querySelector(".navbar-toggler");
    if (window.innerWidth > 990 && navbarCollapse) {
      // Always call collapse.hide() to sync Bootstrap's state
      if (window.bootstrap && window.bootstrap.Collapse) {
        const collapse =
          window.bootstrap.Collapse.getOrCreateInstance(navbarCollapse);
        collapse.hide();
      }
      // Fallback: forcibly remove 'show' class
      navbarCollapse.classList.remove("show");
      // Reset toggler aria-expanded
      if (toggler) {
        toggler.setAttribute("aria-expanded", "false");
        toggler.blur();
      }
    }
  }
  function setupCollapseListener() {
    if (window.bootstrap && window.bootstrap.Collapse) {
      window.addEventListener("resize", collapseNavbarOnDesktop);
      collapseNavbarOnDesktop();
    } else {
      setTimeout(setupCollapseListener, 100);
    }
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupCollapseListener);
  } else {
    setupCollapseListener();
  }
</script>
</script>
<script>
// Use event delegation to ensure loginBtn always works, even if dynamically rendered
document.addEventListener("click", function(e) {
  const btn = e.target.closest && e.target.closest("#loginBtn");
  if (btn) {
    console.log("loginBtn pressed");
    window.dispatchEvent(new CustomEvent("show-login-modal"));
  }
});
</script>
<script>
// Listen for the custom event and trigger the modal using authUI.js logic if available
window.addEventListener("show-login-modal", () => {
  try {
    if (typeof showLoginModal === "function") {
      showLoginModal();
    } else {
      // fallback: try to trigger modal if available
      const modal = document.getElementById("authModal");
      if (modal && window.bootstrap) {
        const modalInstance = new window.bootstrap.Modal(modal);
        modalInstance.show();
      } else {
        console.error("Login modal could not be shown: showLoginModal() missing and no #authModal found or Bootstrap not loaded.");
      }
    }
  } catch (err) {
    console.error("Error while trying to show login modal:", err);
  }
});
</script>
</script>
