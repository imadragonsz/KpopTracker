<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K-Pop Album Tracker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../styles/global.css" />
    <link rel="stylesheet" href="../styles/navbar.css" />
    <link rel="stylesheet" href="../styles/album-cards.css" />
    <link rel="stylesheet" href="../styles/modals.css" />
    <link rel="stylesheet" href="../styles/forms.css" />
    <link rel="stylesheet" href="../styles/loading.css" />
    <link rel="stylesheet" href="/styles/animations.css" />
  </head>
  <body class="profile-bg">
    <div id="navbar-include"></div>
    <script>
      (async function loadNavbarAndScripts() {
        const navbarDiv = document.getElementById("navbar-include");
        if (navbarDiv.dataset.loaded) return;

        // Fetch and inject navbar HTML
        const html = await fetch("./components/navbar.html").then((res) =>
          res.text()
        );
        navbarDiv.innerHTML = html;
        navbarDiv.dataset.loaded = "true";
        // Dynamically load navbar.js after injection
        const script = document.createElement("script");
        script.type = "module";
        script.src = "../js/navbar.js";
        document.body.appendChild(script);

        // Load Supabase and Bootstrap if not already loaded
        const loadScript = (src, type = "text/javascript") =>
          new Promise((resolve, reject) => {
            if ([...document.scripts].some((s) => s.src.includes(src)))
              return resolve();
            const s = document.createElement("script");
            s.src = src;
            s.type = type;
            s.onload = resolve;
            s.onerror = reject;
            document.body.appendChild(s);
          });

        await loadScript(
          "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"
        );
        await loadScript(
          "https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        );

        // Load your app scripts (as modules if needed)
        const appScripts = [
          "../js/components/loading.js",
          "../js/authUI.js",
          "../js/api/supabaseClient.js",
          "../js/api/groupApi.js",
          "../js/api/albumApi.js",
        ];
        for (const src of appScripts) {
          await loadScript(src, "module");
        }

        // Wait for updateAuthUIReady before running dependent code
        window.addEventListener(
          "updateAuthUIReady",
          () => {
            if (typeof window.updateAuthUI === "function")
              window.updateAuthUI();
          },
          { once: true }
        );
      })();
    </script>
    <main>
      <section class="py-5 text-center hero-section">
        <div class="container">
          <img
            src="https://cdn-icons-png.flaticon.com/512/727/727245.png"
            alt="Vinyl Icon"
            style="
              width: 90px;
              height: 90px;
              background: #232a36;
              border-radius: 50%;
              padding: 10px;
              border: 2px solid #43c6ac;
            "
            class="mb-3 mt-2 shadow-none"
          />
          <h1 class="fw-bold mb-2 hero-heading-text text-center">
            K-Pop Album Tracker
          </h1>
          <p class="lead mb-3 hero-lead-text text-center">
            Manage, track, and visualize your K-Pop album collection. Add, edit,
            and browse your albums. See your collection grow with every
            comeback!
          </p>
          <a href="/pages/albumCollection.html" class="btn btn-info btn-lg mt-2"
            >Go to Album Collection</a
          >
        </div>
      </section>
      <div
        class="container p-4 rounded shadow-lg main-container"
        style="
          max-width: 80%;
          background: #232946;
          width: 100%;
          margin-top: 20px;
        "
      >
        <div class="row g-3 mb-4">
          <div class="col-12">
            <div class="card border-info bg-dark">
              <div class="card-body">
                <h2 class="fw-bold text-info mb-3">
                  Why use K-Pop Album Tracker?
                </h2>
                <ul class="list-unstyled lead mb-0">
                  <li>
                    üéµ <b>Album Collection Management:</b> Add, edit, and delete
                    albums and versions, including group, release date, and
                    special versions.
                  </li>
                  <li>
                    üë• <b>Group Management:</b> Organize albums by K-Pop group
                    and view group-specific stats.
                  </li>
                  <li>
                    üìä <b>Profile & Stats:</b> View your collection stats, most
                    collected group, recent activity, and manage your account
                    details.
                  </li>
                  <li>
                    üì± <b>Responsive Design:</b> Mobile-friendly and accessible
                    UI using Bootstrap 5.
                  </li>
                  <li>
                    üíæ <b>Export/Import:</b> Export your collection as CSV or
                    JSON, and import data to migrate or backup your collection.
                  </li>
                  <li>
                    üîê <b>Authentication:</b> Secure login and account
                    management with Supabase.
                  </li>
                  <li>
                    üïí <b>Recent Activity:</b> See your most recently added and
                    updated albums at a glance.
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="row g-3 mb-0">
          <div class="col-12">
            <div
              class="card border-info bg-dark"
              style="border-radius: 18px; box-shadow: 0 2px 16px 0 #43c6ac33"
            >
              <div
                class="card-body p-3"
                style="padding-bottom: 0.5rem !important"
              >
                <h3 class="fw-bold text-info mb-3">Your Digital Shelf</h3>
                <div class="text-secondary mb-2">
                  Sign in to start tracking your albums and see your collection
                  here!
                </div>
                <ul
                  id="album-list"
                  class="list-group"
                  style="
                    background: transparent;
                    border: none;
                    padding: 0;
                    margin: 0;
                  "
                ></ul>
                <!-- Album cards will be rendered here by JavaScript after login -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="alert alert-info text-center" role="alert">
              <b>Feedback?</b> Found a bug or have a feature request?
              <a href="mailto:feedback@kpoptracker.com" class="alert-link"
                >Let us know!</a
              >
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      // Final bulletproof fix: forcibly close navbar after all scripts
      window.addEventListener("load", function () {
        setTimeout(function () {
          var nav = document.getElementById("navbarNav");
          var toggler = document.querySelector(".navbar-toggler");
          if (nav) {
            nav.classList.remove("show", "collapsing");
            nav.classList.add("collapse");
          }
          if (toggler) {
            toggler.setAttribute("aria-expanded", "false");
          }
        }, 0);
      });
    </script>
    <footer
      class="text-center py-4 mt-5"
      style="
        color: #bfc9db;
        background: #232226;
        border-radius: 0 0 18px 18px;
        box-shadow: 0 -2px 16px 0 #a06c8533;
      "
    >
      <div class="container">
        <small>
          K-Pop Album Tracker &copy; 2025. Made with
          <span style="color: #ff6f61">‚ô•</span> for the K-Pop community. |
          <a href="#" style="color: #a06c85">Privacy Policy</a> |
          <a href="#" style="color: #a06c85">Terms</a>
        </small>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="../js/components/loading.js"></script>
    <script type="module" src="../js/authUI.js"></script>
    <script type="module" src="../js/api/supabaseClient.js"></script>
    <script>
      // Dynamically load userMenuModal.js after supabaseClient.js is ready
      (function loadUserMenuModalWhenReady() {
        function injectScript() {
          const script = document.createElement("script");
          script.type = "module";
          script.src = "../js/userMenuModal.js";
          document.body.appendChild(script);
        }
        if (window.supabasePromise) {
          injectScript();
        } else {
          let tries = 0;
          const maxTries = 20;
          const interval = setInterval(() => {
            if (window.supabasePromise) {
              clearInterval(interval);
              injectScript();
            } else if (++tries >= maxTries) {
              clearInterval(interval);
              console.error(
                "userMenuModal.js: supabasePromise not found after waiting."
              );
            }
          }, 100);
        }
      })();
    </script>
  </body>
</html>
